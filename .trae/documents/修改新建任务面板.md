# 修改新建任务面板

## 任务分析

根据用户需求和参考设计，需要修改新建任务面板，主要包括：

1. 增加任务描述部分（非必填）
2. 移除所属看板选择（默认加入待排期）
3. 移除加入日程功能
4. 保留截止时间，默认显示"选择截止时间"
5. 修改标签旁边的小图标
6. 唯一必填字段：任务标题

## 解决方案

### 1. 类型定义分层（DTO分层）

将类型定义分为三层，避免字段污染：

* **TaskCreateDraft**：纯UI草稿（允许空、允许不完整）

* **CreateTaskInput**：提交给后端的最小DTO（title必填，其余可选）

* **Task**：后端返回的完整实体（含id/created\_at/order\_index/status等）

### 2. 组件逻辑修改

#### 2.1 移除"所属看板"选择器

采用**策略A**：创建任务必须绑定"当前board"，UI不显示选择器，但board\_id由上下文自动注入到CreateTaskInput。

#### 2.2 移除"加入日程"功能

* 移除scheduled\_start/end相关字段

* 保留due\_date字段，明确语义为"截止时间"/"交付时间"

#### 2.3 字段归一化

在toCreateTaskInputStep1函数中统一处理：

* title.trim()，空格校验

* description?.trim()，空字符串转undefined

* tags/labels去重、去空

* due\_date统一ISO格式

* 注入board\_id（策略A）

* 前端不写status/created\_at/order\_index（全部由后端处理）

### 3. UI/UX改进

#### 3.1 布局结构

采用标准模态框结构：header + scroll-body + footer，确保：

* 可滚动区域与底部操作区固定

* 内容多时，按钮区不被顶走

#### 3.2 交互体验

* 打开模态框自动focus到标题

* Enter：提交（仅当标题非空）

* Esc：关闭

* Tab顺序正确

#### 3.3 响应式设计

* 设定max-width、max-height（例如高度上限80vh）

* textarea自适应，但有上限

#### 3.4 样式调整

* 增加任务描述部分（textarea）

* 修改标签旁边的小图标

* 截止时间默认显示"选择截止时间"

### 4. 功能验证

#### 4.1 基本功能验证

* 仅标题创建：description/priority/due\_date/tags全空也能成功

* 创建失败提示：标题为空时，按钮禁用 + 明确提示

* 重复点击防抖：提交中禁用按钮，避免创建两条

* 关闭行为一致：X、Esc、点遮罩（如果允许）行为一致

* 提交后状态更新：创建成功后Kanban backlog立即出现，排序正确

* 异常处理：后端报错时提示用户，并保留草稿不丢失

## 具体实现步骤

### 步骤1：修改类型定义

1. 修改`src/features/task-create/taskCreateModal.types.ts`：

   * 调整TaskCreateDraftStep1，增加description字段

   * 移除scheduledDate字段

   * 确保status默认backlog

   * 强化CreateTaskInput的DTO角色

### 步骤2：修改组件逻辑

1. 修改`src/features/task-create/TaskCreateModal.tsx`：

   * 增加任务描述输入框

   * 移除所属看板选择器

   * 移除加入日程功能

   * 修改标签图标

   * 调整截止时间显示

   * 实现Enter/Esc快捷键

   * 优化表单验证

2. 修改`src/features/task-create/taskCreateModal.css`：

   * 调整模态框布局为header + scroll-body + footer

   * 增加任务描述样式

   * 优化响应式设计

### 步骤3：修改数据转换逻辑

1. 修改`toCreateTaskInputStep1`函数：

   * 增加字段归一化处理

   * 注入board\_id

   * 确保数据格式正确

### 步骤4：功能验证

1. 测试仅标题创建功能
2. 测试创建失败提示
3. 测试重复点击防抖
4. 测试关闭行为一致性
5. 测试提交后状态更新
6. 测试异常处理

## 预期效果

1. 新建任务面板符合参考设计
2. 仅任务标题为必填字段
3. 任务描述为非必填
4. 默认加入待排期
5. 移除加入日程功能
6. 截止时间默认显示"选择截止时间"
7. 标签图标符合参考设计
8. 交互体验流畅，支持快捷键
9. 响应式设计，适配不同屏幕尺寸
10. 功能稳定，错误处理完善

## 代码修改点

* `src/features/task-create/taskCreateModal.types.ts`：修改类型定义，实现DTO分层

* `src/features/task-create/TaskCreateModal.tsx`：修改组件逻辑，增加任务描述，移除不必要功能

* `src/features/task-create/taskCreateModal.css`：调整样式，优化布局和交互

