# TaskCreateModal Step1 收敛实现方案

## 目标
将任务创建弹窗严格限制在Step1范围内，确保UI和状态层面都只包含必要字段，避免后续返工。

## 核心要求
1. **UI层面**：只显示3个字段（title、status、dueDate）
2. **状态层面**：使用Step1专用draft类型，只包含3个字段
3. **校验层面**：title为空时提交按钮禁用，实时显示错误
4. **状态管理**：反复打开弹窗不残留旧数据
5. **API层面**：只传递3个字段到后端
6. **状态限制**：status禁止doing选项

## 实现方案

### 1. 类型定义优化
- 保持现有的`TaskCreateDraftStep1`专用类型，确保只包含3个字段
- 确保`toCreateTaskInputStep1`函数只输出必要字段
- 统一dueDate→scheduled_start转换规则：日期+09:00:00

### 2. UI组件清理
- 确保组件层面完全移除对Step2字段的引用
- 确认所有被移除字段的状态管理代码也被删除
- 确保表单id正确，提交按钮form属性生效

### 3. 状态管理优化
- 确保`initialDraft`只包含3个字段
- 关闭弹窗时完全重置状态
- 确保inFlight状态只在请求完成后恢复

### 4. 校验逻辑增强
- 实时校验title，为空时显示错误
- title为空时禁用提交按钮
- 确保错误信息清晰可见

## 验收标准
1. ✅ 弹窗只显示3个字段：title、status、dueDate
2. ✅ title为空时提交按钮禁用
3. ✅ status默认值为todo，且无doing选项
4. ✅ dueDate不选也能创建任务
5. ✅ 反复打开关闭弹窗不残留旧数据
6. ✅ API请求只包含3个字段
7. ✅ inFlight状态正确管理，只在请求完成后恢复
8. ✅ dueDate正确转换为scheduled_start（日期+09:00:00）

## 实现步骤
1. **检查现有代码**：确保组件层面完全移除对Step2字段的引用
2. **修复表单id**：为form元素添加id属性
3. **增强校验逻辑**：实时校验title，为空时禁用提交按钮
4. **确认状态管理**：确保initialDraft只包含3个字段，关闭时完全重置
5. **验证API请求**：确保只传递3个字段到后端
6. **测试所有功能**：验证所有验收标准都能通过

## 关键风险点规避
- **旧字段残留**：通过TS类型检查确保组件层面不再引用Step2字段
- **status取值错误**：移除doing选项，确保status只能是backlog/todo/done
- **dueDate语义不统一**：明确转换规则为日期+09:00:00
- **inFlight状态错误**：确保只在请求完成后恢复按钮状态
- **payload不纯净**：使用专用类型和转换函数确保只传递必要字段

## 预期效果
弹窗界面简洁清晰，只包含Step1必要字段，状态管理严格，API请求纯净，为后续Step2扩展做好准备。